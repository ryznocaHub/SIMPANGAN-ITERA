import{o as d,c as y,w as g,d as t,Q as G,l as F,p as M,E as V,e as p,j as q,b as s,P,F as J,H,U as T,V as I,t as w,f as B,u as D,a as v,r as K}from"./app.35366383.js";import{_ as Q}from"./Master.6e78ae6a.js";import{_ as A}from"./Container.fd7110e0.js";import{_ as k}from"./Label.23df5a7a.js";import{_ as Z}from"./Header1.57f707b5.js";import{_ as W}from"./Input.d1f1fc38.js";import{_ as X}from"./index.3a9c2ea0.js";import{N as Y}from"./Notification.a0596bc5.js";import"./sweetalert2.all.995333e0.js";const ee={class:"grid place-items-center"},te=["src","alt","title"],ie={__name:"File-Preview",props:{file:{type:Object,required:!0},tag:{type:String,default:"li"}},emits:["remove"],setup(n){return(i,u)=>(d(),y(G(n.tag),{class:"file-preview"},{default:g(()=>[t("div",ee,[t("img",{class:"max-w-full min-h-80 max-h-80",src:n.file.url,alt:n.file.file.name,title:n.file.file.name},null,8,te),t("button",{onClick:u[0]||(u[0]=h=>{i.$emit("remove",n.file)}),class:"close-icon"},"\xD7")])]),_:1}))}},se=["data-active","onDragenter","onDragover","onDragleave","onDrop"],ae={__name:"Dropzone",emits:["files-dropped","verifikasi"],setup(n,{emit:i}){let u=F(!1),h=null;function b(){u.value=!0,clearTimeout(h)}function r(){h=setTimeout(()=>{u.value=!1},50)}function m(f){r(),console.log("drpzoneimg"),i("files-dropped",[...f.dataTransfer.files]),i("verifikasi",f.dataTransfer.files[0])}function e(f){f.preventDefault()}const _=["dragenter","dragover","dragleave","drop"];return M(()=>{_.forEach(f=>{document.body.addEventListener(f,e)})}),V(()=>{_.forEach(f=>{document.body.removeEventListener(f,e)})}),(f,S)=>(d(),p("div",{"data-active":s(u),onDragenter:P(b,["prevent"]),onDragover:P(b,["prevent"]),onDragleave:P(r,["prevent"]),onDrop:P(m,["prevent"])},[q(f.$slots,"default",{dropZoneActive:s(u)})],40,se))}},ne={key:0},re={for:"file-input",class:""},oe={key:0},le=t("span",null,"Letakkan Gambar disini",-1),ce=[le],de={key:1},ue=t("span",{c:""},"Seret Gambar disini",-1),me=t("span",{class:"smaller"},[B(" atau "),t("strong",null,[t("em",null,"klik disini")]),B(" untuk memilih file ")],-1),fe=[ue,me],ve={__name:"index",props:{files:{default:null},info:{default:null}},emits:["addFiles","removeFile"],setup(n,{emit:i}){const u=r=>{i("addFiles",r)},h=r=>{i("removeFile",r)};function b(r){i("addFiles",r.target.files),r.target.value=null}return(r,m)=>n.files.length?(d(),p("div",ne,[(d(!0),p(J,null,H(n.files,e=>(d(),y(ie,{key:e.id,file:e,tag:"span",onRemove:h},null,8,["file"]))),128))])):(d(),y(ae,{key:1,class:"drop-area border-4 border-first border-dashed text-center flex flex-col align-center justify-center w-full h-full",onFilesDropped:u},{default:g(({dropZoneActive:e})=>[T(t("div",{class:"text-secondary"},w(n.info.message),513),[[I,n.info.status==9]]),t("label",re,[e?(d(),p("span",oe,ce)):(d(),p("span",de,fe)),t("input",{type:"file",id:"file-input",onChange:b,accept:"image/*",hidden:""},null,32)])]),_:1}))}};function _e(){const n=F([]),i=F([]);function u(r){if(!r[0].type.includes("image"))return i.value=new R("File harus berupa gambar");if(console.log(r[0].size,5*1024*1024),r[0].size>5*1024*1024)return i.value=new R("Ukuran gambar terlalu besar (maks: 5 Mb)");i.value.status=0;let e=[...r].map(_=>new he(_)).filter(_=>!h(_.id));n.value=e}function h(r){return n.value.some(({id:m})=>m===r)}function b(r){const m=n.value.indexOf(r);m>-1&&n.value.splice(m,1),i.value.status=0}return{files:n,info:i,addFiles:u,removeFile:b}}class R{constructor(i){this.message=i,this.status=9}}class he{constructor(i){this.file=i,this.id=`${i.name}-${i.size}-${i.lastModified}-${i.type}`,this.url=URL.createObjectURL(i),this.status=null}}const pe={key:0},ge=["onClick"],be={key:1},xe={class:"flex max-h-96 mb-10"},we={class:"flex-1 max-w-[50%] p-5 flex place-content-center"},ke={key:0,class:"grid place-items-center"},ye=["src"],$e={class:"h3 text-xl font-extrabold tracking-wider"},Pe={class:"list-disc overflow-y-auto",style:{"white-space":"pre-wrap"}},De={class:"flex justify-between mt-10"},Ae=["disabled"],Fe=["onClick"],Se=["disabled"],je=t("h3",{class:"h3 text-xl font-extrabold tracking-wider"}," Data RAB ",-1),Ce=t("div",{class:"divider"},null,-1),Ee={class:"flex flex-wrap"},Be={class:"flex flex-col basis-1/2"},Re={class:"font-bold text-lg tracking-wider"},Te={class:"ml-5 flex flex-col"},Ie={class:"font-bold text-lg tracking-wider"},Le={class:"flex flex-col basis-1/2 mt-5"},Ue={class:"font-bold text-lg tracking-wider"},Oe={class:"flex justify-between"},Ne=["href"],ze=["onClick"],Ge={key:0},Me={key:1},et={__name:"Edit",props:{items:{type:Object},id:{type:Number}},setup(n){const i=n,{files:u,info:h,addFiles:b,removeFile:r}=_e(),m=Y(),e=D({items:i.items,itemPreview:i.items[0],orderArr:N(i.items)}),_=D({forceFormData:!0,_method:"patch",image:null}),f=l=>{_.post(route("unit.item.update",parseInt(e.itemPreview.id)),{onSuccess:()=>{const o=e.itemPreview.id;m("success","Berhasil Unggah Gambar "+e.itemPreview.name),e.itemPreview.id==e.orderArr[e.orderArr.length-1]?C(e.itemPreview.id):j(e.itemPreview.id),e.orderArr=e.orderArr.filter(function(c,a,x){return c!=o}),e.items=e.items.filter(function(c){return c.id!=o})},onError:o=>m("error","Gagal Unggah Gambar "+e.itemPreview.name),onStart:()=>l(),onFinish:()=>l()})},S=D({_method:"patch",status:2}),L=()=>{console.log("props",i.id),S.post(route("unit.procurement.update",i.id),{onSuccess:()=>{m("success","Berhasil mengajukan RAB ")},onError:()=>{m("error","Gagal mengajukan RAB ")}})},U=l=>{b(l),h.value.status!=9&&(_.image=l[0])},$=()=>{r(u.value[0]),_.image=null},j=l=>{const o=e.items.map(a=>a.id).indexOf(l)+1;$();var c=0;for(let a=o;a<e.items.length;a++)if(e.items[a].image==null){c=a;break}e.itemPreview=e.items[c],console.log("finish")},C=l=>{const o=e.items.map(a=>a.id).indexOf(l);$();var c=0;for(let a=o;a>0;a--)if(e.items[a].image==null){c=a-1;break}e.itemPreview=e.items[c],console.log("finish")};function E(l){for(var o="",c=l.toString().split("").reverse().join(""),a=0;a<c.length;a++)a%3==0&&(o+=c.substr(a,3)+".");return"Rp. "+o.split("",o.length-1).reverse().join("")}function O(l){$(),e.itemPreview=e.items[l-1]}function N(l){var o=[];return l.map(function(c){o.push(c.id)}),o}const z=[{text:"Nama",value:"name"},{text:"Jumlah",value:"unit",sortable:!0},{text:"Status",value:"status",sortable:!0},{text:"Aksi",value:"aksi",sortable:!0}];return(l,o)=>{const c=K("EasyDataTable");return d(),y(Q,null,{default:g(({loading:a})=>[s(e).items.length==0?(d(),p("div",pe,[v(X,{text:"Anda sudah mengunggah semua gambar. Silahkan ajukan RAB"},{default:g(()=>[t("button",{class:"btn gap-2 bg-first border-none",onClick:()=>{a(),L()}}," Ajukan RAB ",8,ge)]),_:2},1024)])):(d(),p("div",be,[t("div",null,[t("div",xe,[t("div",we,[s(e).itemPreview.image!=null?(d(),p("div",ke,[t("img",{class:"max-w-full min-h-80 max-h-80",src:s(e).itemPreview.image},null,8,ye)])):(d(),y(ve,{key:1,files:s(u),onAddFiles:U,info:s(h),onRemoveFile:$},null,8,["files","info"]))]),v(A,{class:"flex-1 flex flex-col"},{default:g(()=>[t("h3",$e,w(s(e).itemPreview.name),1),v(k,{value:"Spesifikasi",class:"mb-3 mt-10"}),t("div",Pe,w(s(e).itemPreview.specification),1),t("div",De,[t("button",{class:"btn text-first bg-slate-200 border-none hover:text-white hover:bg-first font-bold",disabled:s(e).orderArr[0]==s(e).itemPreview.id,onClick:o[0]||(o[0]=x=>C(s(e).itemPreview.id))}," < Sebelumnya ",8,Ae),T(t("button",{class:"btn text-white bg-first border-none font-bold",onClick:x=>f(a)}," verifikasi ",8,Fe),[[I,s(_).image]]),t("button",{class:"btn text-first bg-slate-200 border-none hover:text-white hover:bg-first font-bold",disabled:s(e).orderArr[s(e).orderArr.length-1]==s(e).itemPreview.id,onClick:o[1]||(o[1]=x=>j(s(e).itemPreview.id))}," Selanjutnya > ",8,Se)])]),_:2},1024)]),v(A,{class:"card border-2 bg-grey-50 border-dashed border-gray-600 p-5 w-1/3"},{default:g(()=>[je,Ce,t("div",Ee,[t("div",Be,[v(k,{value:"Satuan"}),t("p",Re,w(E(s(e).itemPreview.price)),1)]),t("div",Te,[v(k,{value:"Jumlah"}),t("p",Ie,w(s(e).itemPreview.quantity)+" "+w(s(e).itemPreview.unit),1)]),t("div",Le,[v(k,{value:"Total"}),t("p",Ue,w(E(s(e).itemPreview.total)),1)])]),v(k,{value:"Sumber",class:"mt-5"}),v(W,{class:"w-full",type:"text",isDisable:"",value:s(e).itemPreview.source},null,8,["value"]),t("div",Oe,[t("a",{class:"hover:bg-none text-xs text-first underline underline-offset-8",id:"visit",href:s(e).itemPreview[8],target:"_blank"}," Kunjungi Laman ",8,Ne)])]),_:1})]),v(A,{class:"mt-10"},{default:g(()=>[v(Z,{title:"Daftar Item",widthSize:"60"}),v(c,{headers:z,items:s(e).items,"buttons-pagination":""},{"item-aksi":g(({id:x})=>[t("button",{onClick:Ve=>O(x)},"Lihat",8,ze)]),"item-status":g(({image:x})=>[x?(d(),p("div",Ge," terverifikasi ")):(d(),p("div",Me," tertunda "))]),_:1},8,["items"])]),_:1})]))]),_:1})}}};export{et as default};
